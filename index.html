<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HACCP - Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .header { background: #dc3545; color: white; padding: 25px; text-align: center; border-radius: 10px; margin-bottom: 25px; position: relative; }
        .version { position: absolute; top: 10px; right: 15px; background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 12px; font-size: 0.8em; }
        .header h1 { font-size: 2.2em; margin-bottom: 8px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat { background: #f8f9fa; padding: 18px; border-radius: 8px; text-align: center; border: 2px solid #dee2e6; }
        .stat-number { font-size: 1.8em; font-weight: bold; color: #007bff; margin-bottom: 5px; }
        .stat-label { color: #6c757d; font-size: 0.9em; }
        .spaces { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 18px; }
        .space { background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow: hidden; border: 2px solid #dee2e6; transition: all 0.3s; }
        .space:hover { transform: translateY(-3px); border-color: #007bff; }
        .space-header { background: #f8f9fa; padding: 18px; border-bottom: 1px solid #dee2e6; }
        .space-icon { font-size: 1.8em; margin-bottom: 8px; }
        .space-name { font-size: 1.1em; font-weight: bold; color: #2c3e50; margin-bottom: 4px; }
        .space-temp { color: #007bff; font-weight: 600; font-size: 0.95em; }
        .space-body { padding: 18px; }
        .buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn { padding: 10px 12px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.3s; text-align: center; font-size: 0.85em; }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; transform: translateY(-1px); }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #1e7e34; transform: translateY(-1px); }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 8% auto; padding: 0; border-radius: 12px; width: 85%; max-width: 650px; max-height: 75vh; overflow-y: auto; }
        .modal-header { background: #dc3545; color: white; padding: 18px; border-radius: 12px 12px 0 0; position: relative; }
        .close { color: white; float: right; font-size: 22px; font-weight: bold; cursor: pointer; position: absolute; right: 15px; top: 12px; }
        .close:hover { opacity: 0.7; }
        .modal-body { padding: 20px; }
        .form-section { background: #f8f9fa; padding: 18px; border-radius: 8px; margin-bottom: 18px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 12px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: bold; margin-bottom: 4px; color: #2c3e50; font-size: 0.9em; }
        .form-group input, .form-group textarea { padding: 8px; border: 2px solid #dee2e6; border-radius: 4px; transition: border-color 0.3s; }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: #007bff; }
        .add-btn { background: #28a745; color: white; border: none; padding: 12px 20px; border-radius: 6px; font-weight: bold; cursor: pointer; width: 100%; transition: all 0.3s; }
        .add-btn:hover { background: #1e7e34; transform: translateY(-1px); }
        .table { width: 100%; border-collapse: collapse; background: white; border-radius: 6px; overflow: hidden; }
        .table th { background: #007bff; color: white; padding: 10px; text-align: center; font-weight: bold; font-size: 0.9em; }
        .table td { padding: 8px; text-align: center; border-bottom: 1px solid #dee2e6; font-size: 0.85em; }
        .table tr:hover { background: #f8f9fa; }
        .temp-ok { background: #d4edda; color: #155724; padding: 2px 6px; border-radius: 3px; font-weight: bold; }
        .temp-warn { background: #fff3cd; color: #856404; padding: 2px 6px; border-radius: 3px; font-weight: bold; }
        .temp-bad { background: #f8d7da; color: #721c24; padding: 2px 6px; border-radius: 3px; font-weight: bold; }
        .no-data { text-align: center; color: #6c757d; font-style: italic; padding: 25px; }
        @media (max-width: 768px) { .container { margin: 8px; padding: 15px; } .spaces { grid-template-columns: 1fr; } .modal-content { width: 92%; margin: 15% auto; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="version">v5.0 FIX</div>
            <h1>üå°Ô∏è HACCP FIX</h1>
            <p>Versiune Script Fix - Test</p>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">Total</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="todayCount">0</div>
                <div class="stat-label">AstƒÉzi</div>
            </div>
            <div class="stat">
                <div class="stat-number">2</div>
                <div class="stat-label">Test Spa»õii</div>
            </div>
        </div>
        
        <div class="spaces">
            <div class="space">
                <div class="space-header">
                    <div class="space-icon">ü•ó</div>
                    <div class="space-name">Test Salate</div>
                    <div class="space-temp">+2¬∞C ‚Äì +5¬∞C</div>
                </div>
                <div class="space-body">
                    <div class="buttons">
                        <button class="btn btn-primary" onclick="openTestForm('salate')">üìä Test</button>
                        <button class="btn btn-success" onclick="printTest('salate')">üñ®Ô∏è Print</button>
                    </div>
                </div>
            </div>
            
            <div class="space">
                <div class="space-header">
                    <div class="space-icon">üßä</div>
                    <div class="space-name">Test Congelator</div>
                    <div class="space-temp">‚â§ -18¬∞C</div>
                </div>
                <div class="space-body">
                    <div class="buttons">
                        <button class="btn btn-primary" onclick="openTestForm('congelator')">üìä Test</button>
                        <button class="btn btn-success" onclick="printTest('congelator')">üñ®Ô∏è Print</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="testModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeTestForm()">&times;</span>
                <h2 id="modalTitle">Test Monitorizare</h2>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <h3>üìù Test Formular</h3>
                    <form id="testForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Data:</label>
                                <input type="date" id="testDate" required>
                            </div>
                            <div class="form-group">
                                <label>Ora:</label>
                                <input type="time" id="testTime" required>
                            </div>
                            <div class="form-group">
                                <label>Temperatura:</label>
                                <input type="number" id="testTemp" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label>SemnƒÉtura:</label>
                                <input type="text" id="testSign" required>
                            </div>
                        </div>
                        <button type="submit" class="add-btn">‚úÖ Test Salvare</button>
                    </form>
                </div>
                
                <div id="testResults">
                    <div class="no-data">CompleteazƒÉ formularul pentru test</div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        console.log('üîß HACCP Fix Script - Loading...');
        
        var testData = [];
        var currentTestSpace = '';
        
        function openTestForm(spaceId) {
            console.log('openTestForm called with:', spaceId);
            currentTestSpace = spaceId;
            document.getElementById('modalTitle').innerHTML = 'üß™ Test: ' + spaceId;
            
            var now = new Date();
            document.getElementById('testDate').value = now.toISOString().split('T')[0];
            document.getElementById('testTime').value = now.toTimeString().slice(0,5);
            document.getElementById('testTemp').value = '';
            document.getElementById('testSign').value = '';
            
            document.getElementById('testModal').style.display = 'block';
        }
        
        function closeTestForm() {
            console.log('closeTestForm called');
            document.getElementById('testModal').style.display = 'none';
            currentTestSpace = '';
        }
        
        function printTest(spaceId) {
            console.log('printTest called with:', spaceId);
            
            var printWindow = window.open('', '_blank');
            var html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Test Print</title>';
            html += '<style>body{font-family:Arial;padding:20px}h1{color:#2c3e50;text-align:center}</style>';
            html += '</head><body>';
            html += '<h1>üñ®Ô∏è TEST PRINT HACCP</h1>';
            html += '<h2>Spa»õiu: ' + spaceId + '</h2>';
            html += '<p>Data: ' + new Date().toLocaleDateString() + '</p>';
            html += '<p>Test de printare reu»ôit!</p>';
            html += '<script>window.onload=function(){window.print();}</script>';
            html += '</body></html>';
            
            printWindow.document.write(html);
            printWindow.document.close();
        }
        
        document.getElementById('testForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Form submit triggered');
            
            var record = {
                space: currentTestSpace,
                date: document.getElementById('testDate').value,
                time: document.getElementById('testTime').value,
                temp: document.getElementById('testTemp').value,
                sign: document.getElementById('testSign').value,
                timestamp: new Date().toISOString()
            };
            
            if (!record.temp || isNaN(parseFloat(record.temp))) {
                alert('TemperaturƒÉ invalidƒÉ!');
                return;
            }
            
            testData.push(record);
            
            var resultsHtml = '<div class="form-section">';
            resultsHtml += '<h4>‚úÖ Test Salvat!</h4>';
            resultsHtml += '<p><strong>Spa»õiu:</strong> ' + record.space + '</p>';
            resultsHtml += '<p><strong>TemperaturƒÉ:</strong> ' + record.temp + '¬∞C</p>';
            resultsHtml += '<p><strong>SemnƒÉtura:</strong> ' + record.sign + '</p>';
            resultsHtml += '<p><strong>Total teste:</strong> ' + testData.length + '</p>';
            resultsHtml += '</div>';
            
            document.getElementById('testResults').innerHTML = resultsHtml;
            document.getElementById('totalCount').textContent = testData.length;
            
            console.log('Record saved:', record);
            console.log('All test data:', testData);
            
            alert('‚úÖ Test salvat cu succes!');
        });
        
        window.onclick = function(event) {
            if (event.target === document.getElementById('testModal')) {
                closeTestForm();
            }
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded - initializing...');
            document.getElementById('totalCount').textContent = testData.length;
            document.getElementById('todayCount').textContent = '0';
        });
        
        console.log('‚úÖ HACCP Fix Script - Loaded Successfully!');
    </script>
</body>
</html>
