<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem HACCP - Monitorizare Temperature</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.15); overflow: hidden; }
        .header { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; padding: 40px; text-align: center; }
        .header h1 { font-size: 3em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .main-content { padding: 40px; }
        .dashboard-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: 15px; text-align: center; border: 2px solid #dee2e6; transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-color: #007bff; }
        .stat-number { font-size: 2.5em; font-weight: bold; color: #007bff; margin-bottom: 10px; }
        .stat-label { color: #6c757d; font-size: 1em; font-weight: 500; }
        .spaces-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; margin-bottom: 40px; }
        .space-card { background: white; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); overflow: hidden; transition: all 0.3s ease; border: 2px solid transparent; }
        .space-card:hover { transform: translateY(-8px); box-shadow: 0 15px 40px rgba(0,0,0,0.12); border-color: #007bff; }
        .space-header { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-bottom: 1px solid #dee2e6; }
        .space-icon { font-size: 2.5em; margin-bottom: 10px; display: block; }
        .space-name { font-size: 1.4em; font-weight: bold; color: #2c3e50; margin-bottom: 8px; }
        .temp-range { color: #007bff; font-weight: 600; font-size: 1.1em; }
        .space-body { padding: 25px; }
        .space-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .mini-stat { text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px; }
        .mini-stat-number { font-size: 1.5em; font-weight: bold; color: #28a745; margin-bottom: 5px; }
        .mini-stat-label { font-size: 0.85em; color: #6c757d; }
        .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { padding: 12px 20px; border: none; border-radius: 10px; font-weight: 600; text-decoration: none; text-align: center; transition: all 0.3s ease; cursor: pointer; font-size: 0.9em; display: inline-block; }
        .btn-primary { background: linear-gradient(135deg, #007bff, #0056b3); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,123,255,0.3); }
        .btn-success { background: linear-gradient(135deg, #28a745, #1e7e34); color: white; }
        .btn-success:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(40,167,69,0.3); }
        .management-section { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 30px; border-radius: 20px; margin-top: 30px; border: 2px solid #dee2e6; }
        .management-title { font-size: 1.8em; font-weight: bold; color: #2c3e50; margin-bottom: 20px; text-align: center; }
        .management-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .btn-large { padding: 20px; font-size: 1.1em; border-radius: 15px; }
        .btn-info { background: linear-gradient(135deg, #17a2b8, #117a8b); color: white; }
        .btn-warning { background: linear-gradient(135deg, #ffc107, #e0a800); color: #212529; }
        .btn-danger { background: linear-gradient(135deg, #dc3545, #c82333); color: white; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: white; margin: 2% auto; padding: 0; border-radius: 15px; width: 95%; max-width: 1000px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .modal-header { background: linear-gradient(135deg, #2c3e50, #34495e); color: white; padding: 20px 30px; border-radius: 15px 15px 0 0; position: relative; }
        .close { color: white; float: right; font-size: 28px; font-weight: bold; cursor: pointer; position: absolute; right: 20px; top: 15px; }
        .close:hover { opacity: 0.7; }
        .modal-body { padding: 30px; }
        .input-section { background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 30px; border: 2px solid #dee2e6; }
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .input-group { display: flex; flex-direction: column; }
        .input-group label { font-weight: bold; margin-bottom: 8px; color: #2c3e50; }
        .input-group input, .input-group textarea { padding: 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 16px; transition: border-color 0.3s; }
        .input-group input:focus, .input-group textarea:focus { outline: none; border-color: #007bff; box-shadow: 0 0 0 3px rgba(0,123,255,0.1); }
        .add-btn { background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: all 0.3s; width: 100%; }
        .add-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(40,167,69,0.3); }
        .records-table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .records-table th { background: linear-gradient(135deg, #007bff, #0056b3); color: white; padding: 15px; text-align: center; font-weight: bold; }
        .records-table td { padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6; }
        .records-table tr:hover { background: #f8f9fa; }
        .temp-good { background: #d4edda; color: #155724; font-weight: bold; border-radius: 5px; padding: 5px 10px; }
        .temp-warning { background: #fff3cd; color: #856404; font-weight: bold; border-radius: 5px; padding: 5px 10px; }
        .temp-danger { background: #f8d7da; color: #721c24; font-weight: bold; border-radius: 5px; padding: 5px 10px; }
        .no-records { text-align: center; color: #6c757d; font-style: italic; padding: 40px; }
        @media print { body { background: white !important; padding: 0 !important; } .container { box-shadow: none !important; border-radius: 0 !important; max-width: 100% !important; } .header { background: #2c3e50 !important; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; } .modal { display: none !important; } .btn, .input-section, .management-section { display: none !important; } .space-body { display: none !important; } .space-card { break-inside: avoid !important; margin-bottom: 20px !important; } }
        @media (max-width: 768px) { .container { margin: 10px; border-radius: 15px; } .header { padding: 30px 20px; } .header h1 { font-size: 2.2em; } .main-content { padding: 20px; } .spaces-grid { grid-template-columns: 1fr; } .modal-content { width: 98%; margin: 1% auto; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="version-badge">v3.0 COMPACTA</div>
            <h1>ğŸŒ¡ï¸ Sistem HACCP</h1>
            <p>Monitorizare DigitalÄƒ a Temperaturilor - BucÄƒtÄƒrie Fast Food</p>
        </div>
        
        <div class="main-content">
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalRecords">0</div>
                    <div class="stat-label">ÃnregistrÄƒri Totale</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayRecords">0</div>
                    <div class="stat-label">ÃnregistrÄƒri AstÄƒzi</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="alertsCount">0</div>
                    <div class="stat-label">Alerte Active</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">9</div>
                    <div class="stat-label">SpaÈ›ii Monitorizate</div>
                </div>
            </div>
            
            <div class="spaces-grid">
                <div class="space-card">
                    <div class="space-header">
                        <div class="space-icon">ğŸ¥—</div>
                        <div class="space-name">Masa Rece Salate</div>
                        <div class="temp-range">+2Â°C â€“ +5Â°C</div>
                    </div>
                    <div class="space-body">
                        <div class="space-stats">
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="salate-count">0</div>
                                <div class="mini-stat-label">ÃnregistrÄƒri</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="salate-avg">-Â°C</div>
                                <div class="mini-stat-label">Media Temp</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="openMonitoring('masa-rece-salate')">ğŸ“Š Monitorizare</button>
                            <button class="btn btn-success" onclick="printReport('masa-rece-salate')">ğŸ–¨ï¸ Print</button>
                        </div>
                    </div>
                </div>
                
                <div class="space-card">
                    <div class="space-header">
                        <div class="space-icon">ğŸ…</div>
                        <div class="space-name">Masa Rece Sosuri</div>
                        <div class="temp-range">+2Â°C â€“ +5Â°C</div>
                    </div>
                    <div class="space-body">
                        <div class="space-stats">
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="sosuri-count">0</div>
                                <div class="mini-stat-label">ÃnregistrÄƒri</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="sosuri-avg">-Â°C</div>
                                <div class="mini-stat-label">Media Temp</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="openMonitoring('masa-rece-sosuri')">ğŸ“Š Monitorizare</button>
                            <button class="btn btn-success" onclick="printReport('masa-rece-sosuri')">ğŸ–¨ï¸ Print</button>
                        </div>
                    </div>
                </div>
                
                <div class="space-card">
                    <div class="space-header">
                        <div class="space-icon">ğŸ§Š</div>
                        <div class="space-name">Congelator Produse Ambalate</div>
                        <div class="temp-range">â‰¤ -18Â°C</div>
                    </div>
                    <div class="space-body">
                        <div class="space-stats">
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="congelator-count">0</div>
                                <div class="mini-stat-label">ÃnregistrÄƒri</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="congelator-avg">-Â°C</div>
                                <div class="mini-stat-label">Media Temp</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="openMonitoring('congelator-produse')">ğŸ“Š Monitorizare</button>
                            <button class="btn btn-success" onclick="printReport('congelator-produse')">ğŸ–¨ï¸ Print</button>
                        </div>
                    </div>
                </div>
                
                <div class="space-card">
                    <div class="space-header">
                        <div class="space-icon">ğŸ²</div>
                        <div class="space-name">Frigider Ciorbe</div>
                        <div class="temp-range">+2Â°C â€“ +5Â°C</div>
                    </div>
                    <div class="space-body">
                        <div class="space-stats">
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="ciorbe-count">0</div>
                                <div class="mini-stat-label">ÃnregistrÄƒri</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="ciorbe-avg">-Â°C</div>
                                <div class="mini-stat-label">Media Temp</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="openMonitoring('frigider-ciorbe')">ğŸ“Š Monitorizare</button>
                            <button class="btn btn-success" onclick="printReport('frigider-ciorbe')">ğŸ–¨ï¸ Print</button>
                        </div>
                    </div>
                </div>
                
                <div class="space-card">
                    <div class="space-header">
                        <div class="space-icon">ğŸ¥•</div>
                        <div class="space-name">Frigider Legume & Fructe</div>
                        <div class="temp-range">+2Â°C â€“ +5Â°C</div>
                    </div>
                    <div class="space-body">
                        <div class="space-stats">
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="legume-count">0</div>
                                <div class="mini-stat-label">ÃnregistrÄƒri</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="legume-avg">-Â°C</div>
                                <div class="mini-stat-label">Media Temp</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="openMonitoring('frigider-legume')">ğŸ“Š Monitorizare</button>
                            <button class="btn btn-success" onclick="printReport('frigider-legume')">ğŸ–¨ï¸ Print</button>
                        </div>
                    </div>
                </div>
                
                <div class="space-card">
                    <div class="space-header">
                        <div class="space-icon">ğŸ</div>
                        <div class="space-name">Frigider Sosuri È™i Preparat GÄƒtit</div>
                        <div class="temp-range">+2Â°C â€“ +5Â°C</div>
                    </div>
                    <div class="space-body">
                        <div class="space-stats">
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="preparat-count">0</div>
                                <div class="mini-stat-label">ÃnregistrÄƒri</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="preparat-avg">-Â°C</div>
                                <div class="mini-stat-label">Media Temp</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="openMonitoring('frigider-sosuri-preparat')">ğŸ“Š Monitorizare</button>
                            <button class="btn btn-success" onclick="printReport('frigider-sosuri-preparat')">ğŸ–¨ï¸ Print</button>
                        </div>
                    </div>
                </div>
                
                <div class="space-card">
                    <div class="space-header">
                        <div class="space-icon">ğŸ¥©</div>
                        <div class="space-name">Frigider Carne</div>
                        <div class="temp-range">0Â°C â€“ +4Â°C</div>
                    </div>
                    <div class="space-body">
                        <div class="space-stats">
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="carne-count">0</div>
                                <div class="mini-stat-label">ÃnregistrÄƒri</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="carne-avg">-Â°C</div>
                                <div class="mini-stat-label">Media Temp</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="openMonitoring('frigider-carne')">ğŸ“Š Monitorizare</button>
                            <button class="btn btn-success" onclick="printReport('frigider-carne')">ğŸ–¨ï¸ Print</button>
                        </div>
                    </div>
                </div>
                
                <div class="space-card">
                    <div class="space-header">
                        <div class="space-icon">ğŸ¥›</div>
                        <div class="space-name">Frigider Lactate</div>
                        <div class="temp-range">+2Â°C â€“ +5Â°C</div>
                    </div>
                    <div class="space-body">
                        <div class="space-stats">
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="lactate-count">0</div>
                                <div class="mini-stat-label">ÃnregistrÄƒri</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="lactate-avg">-Â°C</div>
                                <div class="mini-stat-label">Media Temp</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="openMonitoring('frigider-lactate')">ğŸ“Š Monitorizare</button>
                            <button class="btn btn-success" onclick="printReport('frigider-lactate')">ğŸ–¨ï¸ Print</button>
                        </div>
                    </div>
                </div>
                
                <div class="space-card">
                    <div class="space-header">
                        <div class="space-icon">ğŸ“¦</div>
                        <div class="space-name">Frigider/Congelator RezervÄƒ</div>
                        <div class="temp-range">+2Â°C â€“ +5Â°C / â‰¤ -18Â°C</div>
                    </div>
                    <div class="space-body">
                        <div class="space-stats">
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="rezerva-count">0</div>
                                <div class="mini-stat-label">ÃnregistrÄƒri</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="rezerva-avg">-Â°C</div>
                                <div class="mini-stat-label">Media Temp</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="openMonitoring('frigider-rezerva')">ğŸ“Š Monitorizare</button>
                            <button class="btn btn-success" onclick="printReport('frigider-rezerva')">ğŸ–¨ï¸ Print</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="management-section">
                <div class="management-title">ğŸ“‹ Management È™i Rapoarte</div>
                <div class="management-buttons">
                    <button class="btn btn-info btn-large" onclick="exportData()">ğŸ“¤ Export Date</button>
                    <button class="btn btn-danger btn-large" onclick="clearData()">ğŸ—‘ï¸ CurÄƒÈ›are Date</button>
                </div>
            </div>
        </div>
    </div>

    <div id="monitoringModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2 id="modalTitle">Monitorizare SpaÈ›iu Frigorific</h2>
                <div id="modalTempRange"></div>
            </div>
            <div class="modal-body">
                <div class="input-section">
                    <h3 style="margin-bottom: 20px; color: #2c3e50;">ğŸ“ AdaugÄƒ Ãnregistrare NouÄƒ</h3>
                    <form id="temperatureForm">
                        <div class="input-grid">
                            <div class="input-group">
                                <label for="date">Data:</label>
                                <input type="date" id="date" required>
                            </div>
                            <div class="input-group">
                                <label for="time">Ora:</label>
                                <input type="time" id="time" required>
                            </div>
                            <div class="input-group">
                                <label for="temperature">Temperatura (Â°C):</label>
                                <input type="number" id="temperature" step="0.1" required placeholder="Ex: 3.5">
                            </div>
                            <div class="input-group">
                                <label for="signature">SemnÄƒtura:</label>
                                <input type="text" id="signature" required placeholder="Ex: M.P.">
                            </div>
                        </div>
                        <div class="input-group" style="margin-top: 15px;">
                            <label for="observations">ObservaÈ›ii:</label>
                            <textarea id="observations" rows="3" placeholder="ObservaÈ›ii opÈ›ionale..."></textarea>
                        </div>
                        <button type="submit" class="add-btn">â• AdaugÄƒ Ãnregistrare</button>
                    </form>
                </div>
                
                <div id="recordsContainer">
                    <div class="no-records">Nu existÄƒ Ã®nregistrÄƒri pentru acest spaÈ›iu frigorific.</div>
                </div>
            </div>
        </div>
    </div>

<script>
// VERSIUNEA 3.0 COMPACTA - OPTIMIZATA GITHUB PAGES
console.log('ğŸš€ HACCP System v3.0 COMPACTA Ã®ncÄƒrcat cu succes!');

class HACCPDatabase {
    constructor() {
        this.dbName = 'haccp_temperatures';
        this.init();
    }
    init() {
        if (!localStorage.getItem(this.dbName)) {
            localStorage.setItem(this.dbName, JSON.stringify({}));
        }
    }
    getData() {
        try {
            return JSON.parse(localStorage.getItem(this.dbName) || '{}');
        } catch (e) {
            return {};
        }
    }
    saveData(data) {
        try {
            localStorage.setItem(this.dbName, JSON.stringify(data));
            return true;
        } catch (e) {
            return false;
        }
    }
    addRecord(spaceId, record) {
        const data = this.getData();
        if (!data[spaceId]) data[spaceId] = [];
        record.id = Date.now();
        record.timestamp = new Date().toISOString();
        data[spaceId].push(record);
        this.saveData(data);
        return record.id;
    }
    getRecords(spaceId) {
        const data = this.getData();
        return data[spaceId] || [];
    }
    getRecordsCount(spaceId) {
        return this.getRecords(spaceId).length;
    }
    getAverageTemp(spaceId) {
        const records = this.getRecords(spaceId);
        if (records.length === 0) return null;
        const validTemps = records.map(r => parseFloat(r.temperature)).filter(t => !isNaN(t));
        if (validTemps.length === 0) return null;
        const sum = validTemps.reduce((acc, temp) => acc + temp, 0);
        return (sum / validTemps.length).toFixed(1);
    }
    getTodayRecordsCount() {
        const today = new Date().toDateString();
        const allData = this.getData();
        let count = 0;
        Object.values(allData).forEach(spaceRecords => {
            count += spaceRecords.filter(record => 
                new Date(record.timestamp).toDateString() === today
            ).length;
        });
        return count;
    }
    getTotalRecordsCount() {
        const allData = this.getData();
        let count = 0;
        Object.values(allData).forEach(spaceRecords => {
            count += spaceRecords.length;
        });
        return count;
    }
    clearAllData() {
        localStorage.removeItem(this.dbName);
        this.init();
    }
}

const db = new HACCPDatabase();
let currentSpaceId = null;

const spaces = {
    'masa-rece-salate': { name: 'Masa Rece Salate', tempRange: '+2Â°C â€“ +5Â°C', minTemp: 2, maxTemp: 5, icon: 'ğŸ¥—' },
    'masa-rece-sosuri': { name: 'Masa Rece Sosuri', tempRange: '+2Â°C â€“ +5Â°C', minTemp: 2, maxTemp: 5, icon: 'ğŸ…' },
    'congelator-produse': { name: 'Congelator Produse Ambalate', tempRange: 'â‰¤ -18Â°C', minTemp: -30, maxTemp: -18, icon: 'ğŸ§Š' },
    'frigider-ciorbe': { name: 'Frigider Ciorbe', tempRange: '+2Â°C â€“ +5Â°C', minTemp: 2, maxTemp: 5, icon: 'ğŸ²' },
    'frigider-legume': { name: 'Frigider Legume & Fructe', tempRange: '+2Â°C â€“ +5Â°C', minTemp: 2, maxTemp: 5, icon: 'ğŸ¥•' },
    'frigider-sosuri-preparat': { name: 'Frigider Sosuri È™i Preparat GÄƒtit', tempRange: '+2Â°C â€“ +5Â°C', minTemp: 2, maxTemp: 5, icon: 'ğŸ' },
    'frigider-carne': { name: 'Frigider Carne', tempRange: '0Â°C â€“ +4Â°C', minTemp: 0, maxTemp: 4, icon: 'ğŸ¥©' },
    'frigider-lactate': { name: 'Frigider Lactate', tempRange: '+2Â°C â€“ +5Â°C', minTemp: 2, maxTemp: 5, icon: 'ğŸ¥›' },
    'frigider-rezerva': { name: 'Frigider/Congelator RezervÄƒ', tempRange: '+2Â°C â€“ +5Â°C / â‰¤ -18Â°C', minTemp: -30, maxTemp: 5, icon: 'ğŸ“¦' }
};

function openMonitoring(spaceId) {
    currentSpaceId = spaceId;
    const space = spaces[spaceId];
    if (!space) return;

    document.getElementById('modalTitle').innerHTML = space.icon + ' ' + space.name;
    document.getElementById('modalTempRange').innerHTML = '<strong>TemperaturÄƒ ÈšintÄƒ: ' + space.tempRange + '</strong>';

    const now = new Date();
    document.getElementById('date').value = now.toISOString().split('T')[0];
    document.getElementById('time').value = now.toTimeString().split(':').slice(0,2).join(':');

    document.getElementById('temperature').value = '';
    document.getElementById('observations').value = '';
    document.getElementById('signature').value = '';

    renderRecords(spaceId);
    document.getElementById('monitoringModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('monitoringModal').style.display = 'none';
    currentSpaceId = null;
}

function renderRecords(spaceId) {
    const records = db.getRecords(spaceId).reverse();
    const container = document.getElementById('recordsContainer');
    
    if (records.length === 0) {
        container.innerHTML = '<div class="no-records">Nu existÄƒ Ã®nregistrÄƒri pentru acest spaÈ›iu frigorific.</div>';
        return;
    }
    
    const space = spaces[spaceId];
    let tableHTML = '<table class="records-table"><thead><tr><th>Data</th><th>Ora</th><th>Temperatura (Â°C)</th><th>ObservaÈ›ii</th><th>SemnÄƒtura</th></tr></thead><tbody>';
    
    records.forEach(record => {
        const temp = parseFloat(record.temperature);
        const tempClass = getTempClass(temp, space);
        tableHTML += '<tr><td>' + record.date + '</td><td>' + record.time + '</td><td><span class="' + tempClass + '">' + record.temperature + 'Â°C</span></td><td>' + (record.observations || '-') + '</td><td>' + record.signature + '</td></tr>';
    });
    
    tableHTML += '</tbody></table>';
    container.innerHTML = tableHTML;
}

function getTempClass(temp, space) {
    if (temp >= space.minTemp && temp <= space.maxTemp) return 'temp-good';
    if (Math.abs(temp - space.maxTemp) <= 1 || Math.abs(temp - space.minTemp) <= 1) return 'temp-warning';
    return 'temp-danger';
}

function printReport(spaceId) {
    const space = spaces[spaceId];
    const records = db.getRecords(spaceId);
    
    const printWindow = window.open('', '_blank');
    let printHTML = '<!DOCTYPE html><html lang="ro"><head><meta charset="UTF-8"><title>Raport ' + space.name + ' - HACCP</title>';
    printHTML += '<style>@page { size: A4 portrait; margin: 2cm; } * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; color: #333; } .header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #2c3e50; } .header h1 { font-size: 24px; margin-bottom: 10px; color: #2c3e50; } .header h2 { font-size: 18px; margin-bottom: 5px; color: #007bff; } .temp-info { background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 15px 0; text-align: center; font-weight: bold; border: 2px solid #dee2e6; } .meta-info { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; } .meta-card { background: #f8f9fa; padding: 15px; border-radius: 5px; border: 1px solid #dee2e6; } .meta-card h4 { color: #007bff; margin-bottom: 10px; } .records-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; } .records-table th { background: #2c3e50; color: white; padding: 12px 8px; text-align: center; font-weight: bold; font-size: 11px; } .records-table td { padding: 10px 8px; text-align: center; border: 1px solid #dee2e6; font-size: 11px; } .records-table tr:nth-child(even) { background: #f8f9fa; } .temp-good { background: #d4edda; color: #155724; font-weight: bold; border-radius: 3px; padding: 2px 6px; } .temp-warning { background: #fff3cd; color: #856404; font-weight: bold; border-radius: 3px; padding: 2px 6px; } .temp-danger { background: #f8d7da; color: #721c24; font-weight: bold; border-radius: 3px; padding: 2px 6px; } .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #dee2e6; text-align: center; font-size: 10px; color: #6c757d; } @media print { body { print-color-adjust: exact; } }</style></head><body>';
    
    printHTML += '<div class="header"><h1>ğŸŒ¡ï¸ RAPORT HACCP - MONITORIZARE TEMPERATURE</h1><h2>' + space.icon + ' ' + space.name + '</h2><div class="temp-info">TemperaturÄƒ ÈšintÄƒ: ' + space.tempRange + '</div></div>';
    
    printHTML += '<div class="meta-info"><div class="meta-card"><h4>ğŸ“… InformaÈ›ii Raport</h4><p><strong>Data generÄƒrii:</strong> ' + new Date().toLocaleDateString('ro-RO') + '</p><p><strong>Ora generÄƒrii:</strong> ' + new Date().toLocaleTimeString('ro-RO') + '</p><p><strong>Perioada:</strong> Toate Ã®nregistrÄƒrile</p></div><div class="meta-card"><h4>ğŸ“Š Statistici Generale</h4><p><strong>Total Ã®nregistrÄƒri:</strong> ' + records.length + '</p><p><strong>Media temperaturilor:</strong> ' + (db.getAverageTemp(spaceId) || 'N/A') + 'Â°C</p><p><strong>SpaÈ›iu monitorizat:</strong> ' + space.name + '</p></div></div>';
    
    if (records.length > 0) {
        printHTML += '<table class="records-table"><thead><tr><th>Nr.</th><th>Data</th><th>Ora</th><th>Temperatura (Â°C)</th><th>ObservaÈ›ii</th><th>SemnÄƒtura</th></tr></thead><tbody>';
        records.reverse().forEach((record, index) => {
            const temp = parseFloat(record.temperature);
            const tempClass = getTempClass(temp, space);
            printHTML += '<tr><td>' + (index + 1) + '</td><td>' + record.date + '</td><td>' + record.time + '</td><td><span class="' + tempClass + '">' + record.temperature + 'Â°C</span></td><td>' + (record.observations || '-') + '</td><td>' + record.signature + '</td></tr>';
        });
        printHTML += '</tbody></table>';
    } else {
        printHTML += '<p style="text-align: center; font-style: italic; color: #6c757d; padding: 40px;">Nu existÄƒ Ã®nregistrÄƒri pentru acest spaÈ›iu frigorific.</p>';
    }
    
    printHTML += '<div class="footer"><p>Acest raport a fost generat automat de Sistemul HACCP de Monitorizare a Temperaturilor</p><p>Document confidenÈ›ial - utilizare internÄƒ</p></div><script>window.onload = function() { window.print(); };</script></body></html>';
    
    printWindow.document.write(printHTML);
    printWindow.document.close();
}

function exportData() {
    const allData = db.getData();
    const dataStr = JSON.stringify(allData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = 'HACCP_Export_' + new Date().toISOString().split('T')[0] + '.json';
    link.click();
    
    URL.revokeObjectURL(link.href);
}

function clearData() {
    if (confirm('âš ï¸ Sigur doriÈ›i sÄƒ È™tergeÈ›i toate datele? AceastÄƒ acÈ›iune nu poate fi anulatÄƒ.')) {
        db.clearAllData();
        updateDashboard();
        alert('âœ… Toate datele au fost È™terse.');
    }
}

function updateDashboard() {
    document.getElementById('totalRecords').textContent = db.getTotalRecordsCount();
    document.getElementById('todayRecords').textContent = db.getTodayRecordsCount();
    
    const spaceMapping = {
        'masa-rece-salate': 'salate',
        'masa-rece-sosuri': 'sosuri',
        'congelator-produse': 'congelator',
        'frigider-ciorbe': 'ciorbe',
        'frigider-legume': 'legume',
        'frigider-sosuri-preparat': 'preparat',
        'frigider-carne': 'carne',
        'frigider-lactate': 'lactate',
        'frigider-rezerva': 'rezerva'
    };
    
    Object.keys(spaces).forEach(spaceId => {
        const count = db.getRecordsCount(spaceId);
        const avg = db.getAverageTemp(spaceId);
        const shortId = spaceMapping[spaceId];
        
        const countElement = document.getElementById(shortId + '-count');
        const avgElement = document.getElementById(shortId + '-avg');
        
        if (countElement) countElement.textContent = count;
        if (avgElement) avgElement.textContent = avg ? avg + 'Â°C' : '-Â°C';
    });
    
    let alertsCount = 0;
    Object.keys(spaces).forEach(spaceId => {
        const records = db.getRecords(spaceId);
        const space = spaces[spaceId];
        alertsCount += records.filter(record => {
            const temp = parseFloat(record.temperature);
            return temp < space.minTemp || temp > space.maxTemp;
        }).length;
    });
    document.getElementById('alertsCount').textContent = alertsCount;
}

document.getElementById('temperatureForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    if (!currentSpaceId) return;
    
    const record = {
        date: document.getElementById('date').value,
        time: document.getElementById('time').value,
        temperature: document.getElementById('temperature').value,
        observations: document.getElementById('observations').value,
        signature: document.getElementById('signature').value
    };
    
    const temp = parseFloat(record.temperature);
    if (isNaN(temp)) {
        alert('âŒ Te rog sÄƒ introduci o temperaturÄƒ validÄƒ!');
        return;
    }
    
    db.addRecord(currentSpaceId, record);
    
    document.getElementById('observations').value = '';
    document.getElementById('signature').value = '';
    
    const now = new Date();
    document.getElementById('time').value = now.toTimeString().split(':').slice(0,2).join(':');
    
    updateDashboard();
    renderRecords(currentSpaceId);
    
    alert('âœ… Ãnregistrarea a fost salvatÄƒ cu succes!');
});

window.onclick = function(event) {
    const modal = document.getElementById('monitoringModal');
    if (event.target === modal) {
        closeModal();
    }
};

document.addEventListener('DOMContentLoaded', function() {
    updateDashboard();
    
    if (db.getTotalRecordsCount() === 0) {
        addSampleData();
        updateDashboard();
    }
});

function addSampleData() {
    const today = new Date();
    const yesterday = new Date(today);
    yesterday.setDate(yesterday.getDate() - 1);
    
    const sampleRecords = [
        { spaceId: 'masa-rece-salate', temperature: '3.2', observations: 'OK', signature: 'M.P.' },
        { spaceId: 'masa-rece-salate', temperature: '4.1', observations: 'Normal', signature: 'A.S.' },
        { spaceId: 'frigider-carne', temperature: '2.8', observations: 'Verificat', signature: 'D.I.' },
        { spaceId: 'congelator-produse', temperature: '-19.5', observations: 'FuncÈ›ioneazÄƒ perfect', signature: 'M.P.' },
        { spaceId: 'frigider-lactate', temperature: '3.7', observations: 'OK', signature: 'A.S.' }
    ];
    
    sampleRecords.forEach((sample, index) => {
        const record = {
            date: index < 3 ? today.toISOString().split('T')[0] : yesterday.toISOString().split('T')[0],
            time: (8 + index * 2) + ':00',
            temperature: sample.temperature,
            observations: sample.observations,
            signature: sample.signature
        };
        
        db.addRecord(sample.spaceId, record);
    });
}
</script>
</body>
</html>
